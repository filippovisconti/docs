---
tags: [Networks, Routing, Network-synthesis]
title: Network Synthesis
categories: adv-comm-net lecture-notes
---

# Repairing the network is not always easy

- A counter example doesn‚Äôt show the mistake, much less how to fix it.
- The operator must consider the entire specification, not just the part that is violated.
- What if the configuration does not meet a performance objective?
  - Finding the optimal configuration is very difficult.

# Configuration Synthesis

Find a configuration that satisfies the specification ![](/assets/img/Pasted%20image%2020240115153736.png) ![](/assets/img/Pasted%20image%2020240115153754.png) Configuration synthesis makes verification obsolete, if the synthesizer is complete (always finds a solution if one exists).

This is thanks to:

- Automatic configuration repair
- Intent-based networking
- Network optimization

# How to synthesize configurations (SMT + CEGIS)

Find a configuration for which the specification is satisfied for **all** environments.

> [!warning] SMT can only find an assignment of variables that make a formula true. ‚áí We need to parametrize the configuration

For network synthesis, we parametrize the configuration.

- Link weights
- Route maps
- ...

1. Create symbolic variables for each parameter
2. Write the network equations in terms of those parameters.
3. Let SMT do its magic.
4. Reconstruct the configuration from the model.

Parameters can simply be constants in the configuration that are yet unknown. Replace all constants in the symbolic network equations by symbolic variables that represent the parameters. ![](/assets/img/Pasted%20image%2020240115170036.png) Can the network running configuration C compute state Y under inputs X? $$ùùç(Y): specification$$ ![](/assets/img/Pasted%20image%2020240115154025.png) Steady state equations with
configuration parameters: $$Net(X,Y,C)$$ Can the network running configuration C compute state Y under inputs X? $$\text{find } C \text{ such that } ‚àÄ X, Y: Net(X,Y,C) ‚áí ùùç(Y)$$ If the network computes state Y from inputs X, then the specification must be satisfied.

SMT uses many techniques / heuristics to deal with quantifiers. It might take too long to find a solution (or SMT might return undecidable). ![](/assets/img/Pasted%20image%2020240115171625.png)

## Verification vs Synthesis

For verification, we can avoid quantifiers.

> [!tip] Verification Find one set of routing inputs such that the specification is violated.

For synthesis, we need them.

> [!tip] Synthesis Find a configuration for which the specification is satisfied **for** **all** routing inputs.

## What does SMT do with the universal quantifier $\forall$

$‚àÄ$ routing inputs : the corresponding routing state satisfies the specification. ![](/assets/img/Pasted%20image%2020240115154314.png) There are a lot of possible routing inputs! SMT scales exponentially in the input size.

> [!danger] Idea Find a configuration for only a few inputs env and hope that the configuration works for all inputs.

Does the the configuration work for all inputs? ‚§∑ Use verification.

Which inputs should we consider in env? ‚§∑ Use the counter examples from the verification.

## Counter Example Guided Inductive Synthesis (CEGIS)

![](/assets/img/Pasted%20image%2020240115154538.png) ![](/assets/img/Pasted%20image%2020240115172110.png)

### Example

![](/assets/img/Pasted%20image%2020240115154550.png)

The configuration satisfies the specification if $C_{cust} > C_{prov}$ ![](/assets/img/Pasted%20image%2020240115154617.png) Let‚Äôs pick parameters $C_{cust}, C_{prov}$ ‚Äúrandomly‚Äù. ![](/assets/img/Pasted%20image%2020240115154641.png) The verifier finds a counter example x1: ![](/assets/img/Pasted%20image%2020240115154656.png) x1 ‚Äúinvalidates‚Äù the parameter space where $C_{cust} < C_{prov}$ ![](/assets/img/Pasted%20image%2020240115154720.png) The
synthesizer then picks parameters that satisfy x1 ![](/assets/img/Pasted%20image%2020240115154755.png) The synthesizer then finds a counter example x2 ![](/assets/img/Pasted%20image%2020240115154815.png) x2 ‚Äúinvalidates‚Äù the parameter space where $C_{cust} = C_{prov}$ The synthesizer picks parameters that satisfy x1 and x2.

![](/assets/img/Pasted%20image%2020240115154855.png)

We describe the network behavior using equations.

![](/assets/img/Pasted%20image%2020240115165559.png) ![](/assets/img/Pasted%20image%2020240115165613.png) ![](/assets/img/Pasted%20image%2020240115165725.png) ![](/assets/img/Pasted%20image%2020240115165746.png) ![](/assets/img/Pasted%20image%2020240115165802.png) ![](/assets/img/Pasted%20image%2020240115165911.png)

## How can we implement the synthesis block in SMT?

Goal: $$\text{find } C \text{ such that } ‚àÄ X, Y: [X‚àà env ‚àß Net(X,Y,C)] ‚áí ùùç(Y)$$ We still have the ‚àÄ quantifier here (first-order logic). The solver may not be able to solve this problem efficiently.

## Implementation

We only iterate over the environments from our counter examples! ![](/assets/img/Pasted%20image%2020240115172301.png) ![](/assets/img/Pasted%20image%2020240115172327.png) Configurations can be arbitrarily complex. What configuration parameters to consider? We need decide which parameters to include!

- Too few parameters
  - ‚áí solution may not exist!
- Too many parameters
  - ‚áí configuration too complex for humans to understand.
  - ‚áí configuration can only cover the counter examples as corner cases.

>
{: .prompt-tip}
>
> - Start with a small configuration space C.
> - Synthesize configurations from the space C.
> - If no configuration within C ‚Äúworks‚Äù, increase C.

![](/assets/img/Pasted%20image%2020240115172551.png)

## Will CEGIS always terminate?

We have four observations:

1. Ci gets smaller in each step, i.e., $$C_{i+1}\subset C_i$$
2. Ci always includes all configurations, i.e.,$$C_{sol} \subseteq C_i$$
3. We synthesise configurations from Ci, i.e.,$$C_{i+1}\in C_i$$
4. Ci can be infinite.

> In theory, CEGIS might run forever. In practice, CEGIS is efficient.

# Applying synthesis to different networking tasks

All it takes is to view the problem from a different perspective.

## Configuration repair

Synthesise a correct configuration that is similar to the original configuration. ![](/assets/img/Pasted%20image%2020240115173024.png) Configuration repair is just synthesizing a configuration that maximizes the similarity to the old configuration. Use Syntax Guided Synthesis:

1. Start with the configuration space C to only contain the old configuration.
2. Increase the configuration space C slightly when the synthesis step fails
   - ‚áí We will synthesise a configuration that is similar to the initial configuration.

## Optimisation

Can we find a configuration that maximises an optimisation function? ![](/assets/img/Pasted%20image%2020240115173121.png) Performance properties depend on all destinations! But our current network model only considers a single destination at a time.

- SMT is NP-Complete
- With only a single destination, SMT takes minutes to find a solution (for small to medium sized networks).

Some synthesis problems in Networking are better suited for tools like Linear Programming than for SMT.

Let‚Äôs assume a central controller to configure the FIBs. A single entity computes the network-wide forwarding state, and then configures the actual routing tables accordingly.

- We are given the current traffic demand for each source-destination pair.
- Allocate network paths such that maximum link utilisation is minimised.
  - ‚áí Distribute the traffic equally in the network ‚áí Allow the largest deviation in traffic demand

## Configuration is not the only thing we can synthesise

Can we understand what the network does? ![](/assets/img/Pasted%20image%2020240115173254.png) Find the largest specification that a configuration satisfies in a given set of environments.

- Config2Spec finds the maximal set of specifications that are implemented by the configuration.
- The list too large for humans to understand what the network actually does.

In which environments does the network what we want? ![](/assets/img/Pasted%20image%2020240115173352.png) Find the set of environments in which the network satisfies a given specification.

- Invert the specification ‚áí get the entire space of counter examples.
- How ‚Äúrobust‚Äù is the network against external events and failures?

## How to safely reconfigure a network?

A reconfiguration triggers a convergence process. Each intermediate state must satisfy the specification.

- Idea: Synthesise intermediate configuration
- ![](/assets/img/Pasted%20image%2020240115173519.png)

## Research projects

Snowcap finds an ordering of reconfiguration commands. Chameleon synthesises temporary configurations that guarantee safety in all transient states during convergence. The network reconfiguration problem is all about planned events.
